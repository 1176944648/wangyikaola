"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Cartrender=exports.Cartlogin=void 0;var _createClass=function(){function i(o,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}return function(o,e,t){return e&&i(o.prototype,e),t&&i(o,t),o}}(),_tool=require("./tool.js");function _classCallCheck(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}var Cartlogin=function(){function o(){_classCallCheck(this,o),this.login=(0,_tool.$)(".yeslogin"),this.nologin=(0,_tool.$)(".nologin"),this.user=(0,_tool.$)(".yeslogin .username"),this.quit=(0,_tool.$)(".yeslogin .quit"),this.nocart=(0,_tool.$)(".m-nocart"),this.mcart=(0,_tool.$)(".m-cartbox"),this.username=_tool.cookie.getcookie("username"),this.itemlist=(0,_tool.$)(".item-list")}return _createClass(o,[{key:"init",value:function(){var o=this;this.exist(),this.quit.onclick=function(){_tool.cookie.delcookie("username"),o.exist()},this.emptycar()}},{key:"exist",value:function(){this.username?(this.login.css({display:"block"}),this.nologin.css({display:"none"}),this.user.innerHTML=this.username):(this.login.css({display:"none"}),this.nologin.css({display:"block"}))}},{key:"emptycar",value:function(){_tool.cookie.getcookie(this.username+"cookieid")?(this.nocart.css({display:"none"}),this.mcart.css({display:"block"}),this.getdata()):(this.nocart.css({display:"block"}),this.mcart.css({display:"none"}))}},{key:"getdata",value:function(){var e=this;if(_tool.cookie.getcookie(this.username+"cookieid")&&_tool.cookie.getcookie(this.username+"cookienum")){var t=_tool.cookie.getcookie(this.username+"cookieid").split(",");(0,_tool.ajax)({url:"http://10.31.161.143/wangyikaola/php/cart_render.php",type:"post",dataType:"json",data:{sidarr:t}}).then(function(o){e.render(o,t)})}}},{key:"render",value:function(o,e){var t="",i=!0,n=!1,c=void 0;try{for(var s,a=o[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var l=s.value,r=_tool.cookie.getcookie(this.username+"cookienum").split(",")[e.indexOf(l.sid)];t+=' <div class="goods-item goods-item-sele">\n            <div class="goods-info">\n                <div class="cell b-checkbox">\n                    <div class="cart-checkbox">\n                        <input type="checkbox" checked="" name="" id="ocheck" value="" sid='+l.sid+'>\n                        <span class="line-circle"></span>\n                    </div>\n                </div>\n                <div class="cell b-goods">\n                    <div class="goods-name">\n                        <div class="goods-pic">\n                            <a href=""><img src='+l.url+' alt=""></a>\n                        </div>\n                        <div class="goods-msg">\n                            <div class="goods-d-info">\n                                <a href="">'+l.title+'</a>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="cell b-props">\n                    <div class="prop-text"></div>\n                </div>\n                <div class="cell b-price">\n                    <strong>'+l.price+'</strong>\n                </div>\n                <div class="cell b-quantity">\n                    <div class="quantity-form">\n                        <a class="quantity-down" href="javascript:void(0)">-</a>\n                        <input type="text" sid='+l.sid+" value="+r+'>\n                        <a class="quantity-add" href="javascript:void(0)">+</a>\n                    </div>\n                    <div class="quantity-text">有货</div>\n                </div>\n                <div class="cell b-sum">\n                    <strong>'+r*l.price+'</strong>\n                </div>\n                <div class="cell b-action">\n                    <a href="javascript:void(0)" sid='+l.sid+">删除</a>\n                </div>\n            </div>\n        </div>\n           \n        "}}catch(o){n=!0,c=o}finally{try{!i&&a.return&&a.return()}finally{if(n)throw c}}this.itemlist.innerHTML=t,this.acheck=(0,_tool.$)(".cart-checkbox .allsel"),this.ocheck=(0,_tool.$)(".cart-checkbox #ocheck",!0),this.total()}},{key:"total",value:function(){this.allprice=(0,_tool.$)(".totalprice"),this.allcount=(0,_tool.$)(".amount-sum em"),this.oneprice=(0,_tool.$)(".b-price strong",!0),this.onecount=(0,_tool.$)(".quantity-form input",!0),this.subtotal=(0,_tool.$)(".b-sum strong",!0);for(var o=0,e=0,t=0;t<this.oneprice.length;t++){var i=this.oneprice[t].innerHTML*this.onecount[t].value;this.subtotal[t].innerHTML=Math.round(100*i)/100,this.ocheck[t].checked&&(e+=+this.onecount[t].value,o+=+this.subtotal[t].innerHTML)}this.allcount.innerHTML=e,this.allprice.innerHTML="￥"+o,this.oninput(),this.add(),this.allcheck(),this.onecheck(),this.delete(),this.deletecheck()}},{key:"newcookie",value:function(o){var e=_tool.cookie.getcookie(this.username+"cookienum").split(","),t=_tool.cookie.getcookie(this.username+"cookieid").split(","),i=t.indexOf(this.onecount[o].getAttribute("sid"));0!=this.onecount[o].value?e[i]=this.onecount[o].value:(t.splice(i,1),e.splice(i,1)),-1===i&&(t.push(this.onecount[o].getAttribute("sid")),e.push(this.onecount[o].value)),_tool.cookie.addcookie(this.username+"cookieid",t.toString(),10),_tool.cookie.addcookie(this.username+"cookienum",e.toString(),10)}},{key:"oninput",value:function(){for(var e=this,o=function(o){e.onecount[o].onblur=function(){""===e.onecount[o].value&&(e.onecount[o].value=0),e.total(),e.newcookie(o)}},t=0;t<this.onecount.length;t++)o(t)}},{key:"add",value:function(){var t=this;this.up=(0,_tool.$)(".quantity-add",!0),this.down=(0,_tool.$)(".quantity-down",!0);for(var o=function(o){var e=t.onecount[o].value;t.up[o].onclick=function(){e++,t.onecount[o].value=e,t.total(),t.newcookie(o)},t.down[o].onclick=function(){--e<0&&(e=0),t.onecount[o].value=e,t.total(),t.newcookie(o)}},e=0;e<this.up.length;e++)o(e)}},{key:"allcheck",value:function(){for(var i=this,o=function(t){i.acheck[t].onclick=function(){for(var o=0;o<i.ocheck.length;o++)i.ocheck[o].checked=i.acheck[t].checked;for(var e=0;e<i.acheck.length;e++)i.acheck[e].checked=i.acheck[t].checked;i.total()}},e=0;e<this.acheck.length;e++)o(e)}},{key:"onecheck",value:function(){for(var t=this,i=0,o=0;o<this.ocheck.length;o++)this.ocheck[o].onclick=function(){t.total();for(var o=0;o<t.ocheck.length;o++)t.ocheck[o].checked&&i++;for(var e=0;e<t.acheck.length;e++)i!=t.ocheck.length?t.acheck[e].checked=!1:t.acheck[e].checked=!0}}},{key:"delete",value:function(){for(var n=this,c=(0,_tool.$)(".b-action a",!0),o=function(i){c[i].onclick=function(){if(confirm("你确定要删除吗")){n.itemlist.removeChild(c[i].parentNode.parentNode.parentNode),n.total(),n.add();var o=_tool.cookie.getcookie(n.username+"cookienum").split(","),e=_tool.cookie.getcookie(n.username+"cookieid").split(","),t=e.indexOf(c[i].getAttribute("sid"));e.splice(t,1),o.splice(t,1),_tool.cookie.addcookie(n.username+"cookienum",o.toString(),10),_tool.cookie.addcookie(n.username+"cookieid",e.toString(),10)}}},e=0;e<c.length;e++)o(e)}},{key:"deletecheck",value:function(){var n=this;(0,_tool.$)(".alldel").onclick=function(){if(confirm("你确定要删除吗"))for(var o=0;o<n.ocheck.length;o++)if(n.ocheck[o].checked){n.itemlist.removeChild(n.ocheck[o].parentNode.parentNode.parentNode.parentNode),n.total(),n.add();var e=_tool.cookie.getcookie(n.username+"cookienum").split(","),t=_tool.cookie.getcookie(n.username+"cookieid").split(","),i=t.indexOf(n.ocheck[o].getAttribute("sid"));t.splice(i,1),e.splice(i,1),_tool.cookie.addcookie(n.username+"cookienum",e.toString(),10),_tool.cookie.addcookie(n.username+"cookieid",t.toString(),10)}}}}]),o}(),Cartrender=function(){function o(){_classCallCheck(this,o)}return _createClass(o,[{key:"init",value:function(){}}]),o}();exports.Cartlogin=Cartlogin,exports.Cartrender=Cartrender;